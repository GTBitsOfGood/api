FROM node:18-alpine as deps

WORKDIR /app

RUN apk add --update python3 make g++ && rm -rf /var/cache/apk/*

RUN yarn global add node-gyp prisma

COPY package.json ./

RUN mkdir prisma

RUN yarn install 

FROM node:18 as dev

RUN yarn global add nest prisma

WORKDIR /app

COPY --from=deps /app/node_modules ./node_modules/

ENV PATH=/app/node_modules/.bin:$PATH

COPY ./prisma/ ./prisma/

RUN prisma generate

WORKDIR /app/src

COPY . .

EXPOSE 50053 
